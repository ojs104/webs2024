<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>퀴즈 이벤트</title>

    <link rel="stylesheet" href="assets/css/project.css">
</head>

<body>
    <div id="header">
        <a href="quizproject.html">
            <h1>Quiz</h1>
        </a>
    </div>
    <!-- //header -->

    <div id="main">
        <div class="quiz__wrap">
            <div class="quiz">
                <div class="quiz__header"><span>캐릭터 이름을 맞춰봐!</span></div>
                <div class="quiz__main">
                    <div class="quiz_img">
                        <img src="" alt="">
                    </div>
                    <div class="quiz__box">
                        <div class="quiz__question"></div>
                        <div class="quiz__footer">
                            <input type="text" name="text" id="text">
                            <div class="quiz__answer none"></div>
                        </div>
                        <div class="box__footer">
                            <button class="quiz__confirm">정답 확인</button>
                            <button class="quiz__Next none" >다음</button>
                            <div>점수: <span id="score">0</span></div>                            
                        </div>
                        <div class="progress-bar">
                            <div class="filler"></div>
                          </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- //main -->

        <footer id="footer">
            <div class="footer__desc">위 문제는 애니메이션 캐릭터가 나오는 문제입니다.</div>

        </footer>
        <!-- //footer -->


        <script>
            const quizData = [
                {
                    "question": "내가 누구게요~?",
                    "answer": "도널드덕",
                    "imageURL": "../quiz/assets/project img/img1-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "말레피센트",
                    "imageURL": "../quiz/assets/project img/img2-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "뮬란",
                    "imageURL": "../quiz/assets/project img/img3-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "미키마우스",
                    "imageURL": "../quiz/assets/project img/img4-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "버즈",
                    "imageURL": "../quiz/assets/project img/img5-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "버럭이",
                    "imageURL": "../quiz/assets/project img/img6-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "스티치",
                    "imageURL": "../quiz/assets/project img/img7-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "슬픔이",
                    "imageURL": "../quiz/assets/project img/img8-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "지니",
                    "imageURL": "../quiz/assets/project img/img9-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "엘사",
                    "imageURL": "../quiz/assets/project img/img10-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "우슬라",
                    "imageURL": "../quiz/assets/project img/img11-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "크루엘라",
                    "imageURL": "../quiz/assets/project img/img12-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "티몬",
                    "imageURL": "../quiz/assets/project img/img13-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "비비",
                    "imageURL": "../quiz/assets/project img/img14.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "포키",
                    "imageURL": "../quiz/assets/project img/img15-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "품바",
                    "imageURL": "../quiz/assets/project img/img16-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "패트와 매트",
                    "imageURL": "../quiz/assets/project img/img17-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "네즈코",
                    "imageURL": "../quiz/assets/project img/img18-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "고죠 사토루",
                    "imageURL": "../quiz/assets/project img/img19-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "핑구",
                    "imageURL": "../quiz/assets/project img/img20-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "스폰지밥",
                    "imageURL": "../quiz/assets/project img/img21-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "훈이",
                    "imageURL": "../quiz/assets/project img/img22-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "세일러문",
                    "imageURL": "../quiz/assets/project img/img23-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "코스모",
                    "imageURL": "../quiz/assets/project img/img24-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "보스 베이비",
                    "imageURL": "../quiz/assets/project img/img25-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "할리퀸",
                    "imageURL": "../quiz/assets/project img/img26-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "버블",
                    "imageURL": "../quiz/assets/project img/img27-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "스파이더맨",
                    "imageURL": "../quiz/assets/project img/img28-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "아이스베어",
                    "imageURL": "../quiz/assets/project img/img29-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "브레드",
                    "imageURL": "../quiz/assets/project img/img30-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "플랑크톤",
                    "imageURL": "../quiz/assets/project img/img31-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "플래시",
                    "imageURL": "../quiz/assets/project img/img32-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "티미",
                    "imageURL": "../quiz/assets/project img/img33-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "덱스터",
                    "imageURL": "../quiz/assets/project img/img34-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "보우",
                    "imageURL": "../quiz/assets/project img/img35-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "엄마상어",
                    "imageURL": "../quiz/assets/project img/img36-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "콩순이",
                    "imageURL": "../quiz/assets/project img/img37-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "윌크",
                    "imageURL": "../quiz/assets/project img/img38-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "완다",
                    "imageURL": "../quiz/assets/project img/img39-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "닥터 스트레인저",
                    "imageURL": "../quiz/assets/project img/img40-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "아냐",
                    "imageURL": "../quiz/assets/project img/img41-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "다크시니",
                    "imageURL": "../quiz/assets/project img/img42-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "레드후드",
                    "imageURL": "../quiz/assets/project img/img43-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "한자와",
                    "imageURL": "../quiz/assets/project img/img44-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "가오나시",
                    "imageURL": "../quiz/assets/project img/img45-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "내퍼",
                    "imageURL": "../quiz/assets/project img/img46-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "노지코",
                    "imageURL": "../quiz/assets/project img/img47-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "도도리아",
                    "imageURL": "../quiz/assets/project img/img48-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "라데츠",
                    "imageURL": "../quiz/assets/project img/img49-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "레일리",
                    "imageURL": "../quiz/assets/project img/img50-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "루피",
                    "imageURL": "../quiz/assets/project img/img51-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "빅맘",
                    "imageURL": "../quiz/assets/project img/img52.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "오룡",
                    "imageURL": "../quiz/assets/project img/img53.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "오타마",
                    "imageURL": "../quiz/assets/project img/img54.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "유바바",
                    "imageURL": "../quiz/assets/project img/img55.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "자봉",
                    "imageURL": "../quiz/assets/project img/img56.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "츠루",
                    "imageURL": "../quiz/assets/project img/img57.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "코비",
                    "imageURL": "../quiz/assets/project img/img58.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "크리링",
                    "imageURL": "../quiz/assets/project img/img59.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "타시기",
                    "imageURL": "../quiz/assets/project img/img60.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "푸알",
                    "imageURL": "../quiz/assets/project img/img61.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "프랑키",
                    "imageURL": "../quiz/assets/project img/img62.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "하쿠",
                    "imageURL": "../quiz/assets/project img/img63.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "아구몬",
                    "imageURL": "../quiz/assets/project img/img64-min.png"

                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "미소",
                    "imageURL": "../quiz/assets/project img/img65-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "뿌까",
                    "imageURL": "../quiz/assets/project img/img66-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "햄토리",
                    "imageURL": "../quiz/assets/project img/img67-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "단비",
                    "imageURL": "../quiz/assets/project img/img68-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "톰과 제리",
                    "imageURL": "../quiz/assets/project img/img69-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "하울",
                    "imageURL": "../quiz/assets/project img/img70-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "피카츄",
                    "imageURL": "../quiz/assets/project img/img71-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "케로로",
                    "imageURL": "../quiz/assets/project img/img72-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "체리",
                    "imageURL": "../quiz/assets/project img/img73-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "또치",
                    "imageURL": "../quiz/assets/project img/img74-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "모아나",
                    "imageURL": "../quiz/assets/project img/img75-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "엠버",
                    "imageURL": "../quiz/assets/project img/img76-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "코코",
                    "imageURL": "../quiz/assets/project img/img77-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "옐로우",
                    "imageURL": "../quiz/assets/project img/img78-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "루피",
                    "imageURL": "../quiz/assets/project img/img79-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "토마스",
                    "imageURL": "../quiz/assets/project img/img80-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "동동이",
                    "imageURL": "../quiz/assets/project img/img81-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "바론",
                    "imageURL": "../quiz/assets/project img/img82-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "레미",
                    "imageURL": "../quiz/assets/project img/img83-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "청명",
                    "imageURL": "../quiz/assets/project img/img84-min.png"
                },
                {
                    "question": "내가 누구게요~?",
                    "answer": "커리지",
                    "imageURL": "../quiz/assets/project img/img85-min.png"
                }

            ];
            let currentQuizIndex = 0; // 현재 퀴즈 인덱스
            let score = 0;
            let countdownInterval; // 카운트다운을 관리하는 인터벌 변수
            const feedbackDiv = document.createElement("div"); // 피드백 div를 전역 스코프에서 선언
            let countdownPaused = false; // 카운트다운 일시 정지 상태를 나타내는 변수
            let excludedIndices = []; // 기존에 출제된 문제의 인덱스를 추적하는 배열

            const progressBar = document.querySelector(".progress-bar .filler");
            let progressWidth = 0; // 초기 게이지 너비


    // DOM 요소를 가져옵니다.
    const quizHeader = document.querySelector(".quiz__header span");
    const quizImage = document.querySelector(".quiz_img img");
    const quizQuestion = document.querySelector(".quiz__question");
    const quizAnswerInput = document.querySelector("#text");
    const quizConfirmButton = document.querySelector(".quiz__confirm");
    const quizNextButton = document.querySelector(".quiz__Next");
    const quizAnswer = document.querySelector(".quiz__answer");
    const countdownDiv = document.createElement("div");

    // 초기 퀴즈 데이터를 표시합니다.
    displayQuizData();

    // 정답 확인 버튼 클릭 이벤트 핸들러를 등록합니다.
    quizConfirmButton.addEventListener("click", checkAnswer);

    // 다음 버튼 클릭 이벤트 핸들러를 등록합니다.
    quizNextButton.addEventListener("click", nextQuestion);

    // 정답 입력 필드에서 Enter 키를 눌렀을 때도 정답 확인 함수를 호출합니다.
    quizAnswerInput.addEventListener("keyup", function (event) {
        if (event.key === "Enter") {
            checkAnswer();
        }
    });

    // 퀴즈 데이터를 랜덤으로 섞습니다.
    function shuffleQuizData() {
        for (let i = quizData.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [quizData[i], quizData[j]] = [quizData[j], quizData[i]];
        }
    }

    // 초기화 함수를 호출하여 퀴즈 데이터를 섞고 첫 번째 퀴즈를 표시합니다.
    function initializeQuiz() {
        shuffleQuizData(); // 퀴즈 데이터를 섞음
        currentQuizIndex = 0; // 현재 퀴즈 인덱스 초기화
        score = 0; // 점수 초기화
        document.getElementById("score").textContent = score; // 점수 표시 초기화
        excludedIndices = []; // 기존에 출제된 문제의 인덱스 초기화
        displayQuizData(); // 첫 번째 퀴즈를 표시
    }

    initializeQuiz();
    //게이지
    function fillGauge() {
        progressWidth += 100 / quizData.length; // 정답을 맞출 때마다 게이지 너비를 1/문제 수 만큼 증가
        progressBar.style.width = progressWidth + "%"; // 게이지 너비 설정

        setTimeout(function () {
            if (currentQuizIndex === quizData.length - 1) {
            // 모든 문제를 푼 경우
            alert("퀴즈가 종료되었습니다.");
        } else {
            nextQuestion(); // 다음 문제로 이동
        }
    }, 1000); // 게이지 채워짐 애니메이션 지속 시간과 동일한 시간을 설정합니다. 여기서는 0.7초로 설정했습니다.
    }

    // 정답 확인 함수를 정의합니다.
function checkAnswer() {
    clearInterval(countdownInterval); // 카운트다운 중지

    const userAnswer = quizAnswerInput.value.trim().toLowerCase(); // 입력한 답을 소문자로 변환
    const correctAnswer = quizData[currentQuizIndex].answer.replace(/\s/g, "").toLowerCase(); // 정답을 소문자로 변환

    if (userAnswer === correctAnswer) {
        score++;
        document.getElementById("score").textContent = score;
        nextQuestion();
        fillGauge(); 
    } else {
        feedbackDiv.textContent = "땡! 정답은 " + quizData[currentQuizIndex].answer + " 입니다.";
        feedbackDiv.classList.add("feedback");
        document.querySelector(".quiz__box").appendChild(feedbackDiv);

        setTimeout(function () {
            feedbackDiv.remove();
            nextRandomQuestion(); // 2초 후에 다음 랜덤 화면으로 넘어가기
        }, 2000); // 2초 후에 피드백 제거 및 다음 화면으로 이동
    }
}

// 랜덤으로 다음 문제를 선택하는 함수
function nextRandomQuestion() {
    const remainingIndices = quizData
        .map((_, index) => index)
        .filter((index) => index !== currentQuizIndex); // 현재 문제 인덱스 제외

    if (remainingIndices.length === 0) {
        // 모든 문제가 출제되었을 경우
        alert("퀴즈가 종료되었습니다.");
        return;
    }

    const randomIndex = Math.floor(Math.random() * remainingIndices.length);
    currentQuizIndex = remainingIndices[randomIndex]; // 랜덤하게 다음 문제 선택
    displayQuizData();
    startCountdown();
}

    function nextQuestion() {
        clearInterval(countdownInterval); // 이전 카운트다운 인터벌 해제
        currentQuizIndex = selectRandomQuestionIndex(); // 다음 퀴즈로 이동
        if (currentQuizIndex === -1) {
            // 모든 문제가 출제되었을 경우
            alert("퀴즈가 종료되었습니다.");
            return;
        }

        displayQuizData(); // 새로운 퀴즈 데이터 표시
        startCountdown(); // 카운트다운 재시작
        quizAnswerInput.value = ""; // 입력 필드 초기화
    }

    function selectRandomQuestionIndex() {
        const remainingIndices = quizData
            .map((_, index) => index)
            .filter((index) => !excludedIndices.includes(index));

        if (remainingIndices.length === 0) {
            return -1; // 모든 문제가 출제되었을 경우
        }

        const randomIndex = Math.floor(Math.random() * remainingIndices.length);
        const selectedIndex = remainingIndices[randomIndex];
        excludedIndices.push(selectedIndex);
        return selectedIndex;
    }

    // 카운트 다운을 시작하는 함수
    function startCountdown() {
        countdownDiv.textContent = "7"; // 초기 카운트 값을 설정합니다.
        countdownDiv.classList.add("countdown");
        document.querySelector(".quiz__box").appendChild(countdownDiv);

        let count = 7;
        countdownInterval = setInterval(function () {
            count--;
            countdownDiv.textContent = count; // 남은 시간을 업데이트합니다.

            if (count <= 0) {
                clearInterval(countdownInterval); // 카운트가 종료되면 setInterval을 해제합니다.
                countdownDiv.remove(); // 카운트 다운 요소를 제거합니다.
                handleTimeout(); // 시간 초과 처리
            }
        }, 1000); // 1초마다 카운트를 감소시킵니다.
    }

// 시간 초과 처리 함수
function handleTimeout() {
    feedbackDiv.textContent = "시간 초과! 정답은 " + quizData[currentQuizIndex].answer + " 입니다.";
    feedbackDiv.classList.add("feedback");
    document.querySelector(".quiz__box").appendChild(feedbackDiv);

    setTimeout(function () {
        feedbackDiv.remove();
        if (excludedIndices.length < quizData.length) {
            // 아직 출제되지 않은 문제가 남아있을 경우
            const restart = confirm("다시 시작하시겠습니까?");
            if (restart) {
                nextQuestion(); // 다음 문제 출제
            } else {
                alert("퀴즈가 종료되었습니다.");
            }
        } else {
            // 모든 문제가 출제되었을 경우
            alert("퀴즈가 종료되었습니다.");
        }
        fillGauge(); // 시간 초과 시 게이지 채우기 함수 호출
    }, 2000); // 2초 후에 피드백 제거 및 처리
}

// 퀴즈 데이터를 화면에 표시하는 함수를 정의합니다.
function displayQuizData() {
    const currentQuiz = quizData[currentQuizIndex];
    quizImage.src = currentQuiz.imageURL;
    quizQuestion.textContent = currentQuiz.question;
}




// 페이지 로드 시 초기 카운트다운을 시작합니다.
startCountdown();



</script>
</body>

</html>